<div *ngIf="(searchResults$ | async) as searchResults" class="search-container v-flex"
     [ngClass]="{'focused_no_value': searchInput.value.trim() === '', 'focused': isToolbarSearchFocused}">
  <div class="search-bar-container h-flex align-center" [ngClass]="{'focused': isToolbarSearchFocused}">
    <span class="material-icons-round">search</span>
    <input #searchInput
           appMyAutocomplete
           [searchValue]="searchValue"
           (focusin)="isToolbarSearchFocused = true"
           [ngModel]="searchValue || ''"
           (ngModelChange)="searchDiseases($event)"
           value=""
           class="search-bar-input"
           autocorrect="off"
           spellcheck="false"
           placeholder="Search phenotypes, studies, platforms"
           autocomplete="off"
           type="text" aria-label="Search"/>
  </div>

  <div class="search_suggestions_container" *ngIf="searchInput.value && isToolbarSearchFocused">

    <div class="search_filters_container h-flex align-center">

      <span>Filters: </span>

      <mat-chip-list aria-label="Search Autocomplete Filters">
        <mat-chip *ngFor="let searchOption of searchFiltersAvailable" (click)="toggleFilter(searchOption)"
                  color="primary" class="app-chip"
                  [ngClass]="{'app-chip-selected': searchFiltersInUse?.includes(searchOption) }" selected>
          <mat-icon fontSet="material-icons-round">done</mat-icon>
          {{searchOption}}
        </mat-chip>
      </mat-chip-list>

    </div>



    <content-loader
      *ngIf="loadingSearchResults$ | async"
      viewBox="0 0 400 130"
      speed="1"
      backgroundColor="#eef1f0"
      foregroundColor="#dbe3e1"
    >
      <svg:circle cx="18" cy="17" r="10" />
      <svg:rect x="38" y="10" rx="7" ry="7" width="167" height="14" />
      <svg:circle cx="18" cy="48" r="10" />
      <svg:rect x="38" y="41" rx="7" ry="7" width="242" height="14" />
      <svg:circle cx="18" cy="80" r="10" />
      <svg:rect x="38" y="73" rx="7" ry="7" width="125" height="14" />
      <svg:circle cx="18" cy="112" r="10" />
      <svg:rect x="38" y="105" rx="7" ry="7" width="154" height="14" />
    </content-loader>

    <app-empty-illustration
      *ngIf="searchResults.length === 0 && !(loadingSearchResults$ | async)"
      issueText="No results found in our datasets"
      solutionText="Check your spelling or try a different term"
    ></app-empty-illustration>

    <ng-container *ngIf="searchResults.length > 0 && !(loadingSearchResults$ | async)">

      <div (mouseleave)="removeResultMouseOver()" class="search_suggestions">
        <a (mouseenter)="onSearchResultMouseOver($event, i)" (click)="selectResult(suggestion.name)"
           *ngFor="let suggestion of searchResults let i = index"
           [ngClass]="{'on_focus': (cursor$ | async) === i}" [routerLink]="suggestion | searchResultUrl">

          <span class="suggestion_primary">{{suggestion.name}}</span>

          <ng-template [ngIf]="suggestion?.categoryName">
            <span class="dot">•</span>
            <span class="suggestion_secondary">{{suggestion?.categoryName}}</span>
          </ng-template>

          <ng-template [ngIf]="suggestion?.foundIn">
            <span class="dot">•</span>
            <span class="suggestion_secondary">{{suggestion?.foundIn}}</span>
          </ng-template>
        </a>
      </div>

      <button (click)="performSearch()" class="outline_button with-radius">
        <span class="material-icons-round">manage_search</span>
        <!--      TODO: use the actual number of results  -->
        View all {{102001 | shortNumber}} results
      </button>
    </ng-container>
  </div>


</div>
